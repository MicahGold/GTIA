<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Negotiation Rules - Intellicorp Dispute</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding-top: 70px;
      background-color: #f9f9f9;
    }
    nav {
      position: fixed; top: 0; left: 0; right: 0; height: 60px;
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(8px);
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 40px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      z-index: 1000;
    }
    nav ul { list-style: none; margin:0; padding:0; display:flex; gap:25px; }
    nav a {
      text-decoration: none; color:#333; font-size:16px; font-weight:500;
      padding:10px 15px; border-radius:6px; transition:background-color 0.25s;
    }
    nav a:hover { background-color:#e0e0e0; color:#000 }
    nav a.active { background-color:#0066cc; color:#fff }

    .section {
      margin: 40px; background:#fff; padding:30px;
      border-radius:12px; box-shadow:0 4px 16px rgba(0,0,0,0.05);
    }

    h2 { color:#333; font-size:28px; margin-bottom:20px }

    form.rules-list { line-height:1.8; color:#444 }
    .rules-list label { display:block; margin-bottom:12px }
    .nested { margin-left:20px }
    .input-box { margin:20px 0 }
    .input-box input[type="number"] {
      padding:8px; font-size:16px; border:1px solid #ccc;
      border-radius:6px; width:200px;
    }
    .input-box input:disabled {
      background-color: #eee;
    }
    .submit-btn button {
      background-color:#0066cc; color:#fff; padding:10px 20px;
      font-size:16px; border:none; border-radius:6px; cursor:pointer;
      transition:background-color 0.3s;
    }
    .submit-btn button:hover { background-color:#004a99 }

    /* Results */
    #results { display:none }
    #results table {
      width:100%; border-collapse:collapse; margin-top:20px;
    }
    #results th, #results td {
      border:1px solid #ddd; padding:8px; text-align:left;
    }
    #results th { background:#f2f2f2; font-weight:bold }
    .positive { color:green }
    .negative { color:red }
  </style>
</head>
<body>

  <nav>
    <ul>
      <li><a href="index.html">Case Introduction</a></li>
      <li><a href="dramatis-personae.html">Dramatis Personae</a></li>
      <li><a href="facts.html">Facts</a></li>
      <li><a href="rules.html" class="active">Negotiation Rules</a></li>
      <li><a href="misc-analysis.html">Misc Analysis</a></li>
      <li><a href="nash.html">BATNA & ZOPA</a></li>
      <li><a href="strategy.html">Negotiation Strategy</a></li>
      <li><a href="submit.html">Submit Deal</a></li>
    </ul>
  </nav>

  <div class="section">
    <h2>Deal Terms</h2>
    <form class="rules-list" action="#" method="POST">
      <label>
        <strong>Litigate:</strong><br>
        <input type="radio" name="litigate" value="yes"> Yes
        <input type="radio" name="litigate" value="no"> No
      </label>

      <label>
        <strong>Pay in Full:</strong><br>
        <input type="radio" name="pay_full" value="yes"> Yes
        <input type="radio" name="pay_full" value="no"> No
      </label>

      <label>
        <strong>Settlement:</strong><br>
        <input type="radio" name="settlement" value="yes"> Yes
        <input type="radio" name="settlement" value="no"> No
      </label>

      <div class="nested">
        <label>
          Geoff commits to have two future MRI scans at Intellicorp for same price:<br>
          <input type="radio" name="future_scans" value="yes"> Yes
          <input type="radio" name="future_scans" value="no"> No
        </label>
      </div>

      <div class="input-box">
        <label for="settlement_amount"><strong>Settlement Amount Offered ($):</strong></label><br>
        <input type="number" name="settlement_amount" id="settlement_amount" placeholder="e.g., 3500">
      </div>

      <div class="submit-btn">
        <button type="submit">Submit Terms</button>
      </div>
    </form>
  </div>

  <div id="results" class="section"></div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.querySelector('form.rules-list');
      const groupNames = ['litigate','pay_full','settlement'];
      const scanInputs = form.querySelectorAll('input[name="future_scans"]');
      const amountInput = document.getElementById('settlement_amount');

      function updateGroups() {
        // determine which main choice is yes
        const active = groupNames.find(name =>
          form.querySelector(`input[name="${name}"][value="yes"]`).checked
        ) || null;

        // disable other two groups
        groupNames.forEach(name => {
          form.querySelectorAll(`input[name="${name}"]`).forEach(inp => {
            inp.disabled = !!active && name !== active;
          });
        });

        // scans only enabled for Settlement
        const scansEnabled = (active === 'settlement');
        scanInputs.forEach(inp => inp.disabled = !scansEnabled);

        // if Settlement â‰  yes, auto-set scans to no
        if (!scansEnabled) {
          const noScan = form.querySelector('input[name="future_scans"][value="no"]');
          if (noScan) noScan.checked = true;
        }

        // settlement amount only enabled for Settlement
        if (active === 'settlement') {
          amountInput.disabled = false;
        } else {
          amountInput.disabled = true;
          amountInput.value = '';
        }
      }

      // attach listeners
      groupNames.forEach(name => {
        form.querySelectorAll(`input[name="${name}"]`).forEach(radio =>
          radio.addEventListener('change', updateGroups)
        );
      });
      updateGroups();  // initial state

      // on submit compute EVs & render
      form.addEventListener('submit', e => {
        e.preventDefault();
        const lit = form.elements['litigate'].value;
        const pay = form.elements['pay_full'].value;
        const setl = form.elements['settlement'].value;
        const scans = form.elements['future_scans'].value;
        const xVal = parseFloat(amountInput.value);
        const chosen = [lit,pay,setl].filter(v=>v==='yes');

        if (chosen.length!==1)
          return alert('Select exactly one of Litigation, Pay in Full, or Settlement.');
        if (setl==='yes' && isNaN(xVal))
          return alert('Enter a settlement amount.');

        const ev = {};
        if (setl==='yes') {
          if (scans==='yes') {
            ev.Geoff        = -3*xVal;
            ev.Steph        = -3*xVal;
            ev.Intellicorp  = 21948+3*xVal;
            ev.Heath        = 474+1.5*xVal;
            ev.Aesculapius  = 474+1.5*xVal;
          } else {
            ev.Geoff        = -xVal-4700;
            ev.Steph        = -xVal-4700;
            ev.Intellicorp  = 7316+xVal;
            ev.Heath        = 158+0.5*xVal;
            ev.Aesculapius  = 158+0.5*xVal;
          }
        } else if (pay==='yes') {
          ev.Geoff       = -8205;
          ev.Steph       = -8205;
          ev.Intellicorp = 10621;
          ev.Heath       = 1448.40;
          ev.Aesculapius = 2172.60;
        } else {
          ev.Geoff       = -7510.13;
          ev.Steph       = -10210.13;
          ev.Intellicorp = 10196.39;
          ev.Heath       = 151.20;
          ev.Aesculapius = 151.20;
        }

        const res = document.getElementById('results');
        let html = '<h2>Expected Values</h2><table><tr><th>Party</th><th>EV ($)</th></tr>';
        for (let p in ev) {
          const num = ev[p].toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
          const cls = ev[p]<0 ? 'negative':'positive';
          html += `<tr><td>${p}</td><td class="${cls}">${num}</td></tr>`;
        }
        html += '</table>';
        res.innerHTML = html;
        res.style.display = 'block';
      });
    });
  </script>
</body>
</html>
